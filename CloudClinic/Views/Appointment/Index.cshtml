@model IEnumerable<CloudClinic.Models.DataModel.Appointment>

@{
    ViewBag.Title = "Index";
}

<h2>Index</h2>



<p>
    @Html.ActionLink("Create New", "Create")
</p>
@*<table class="table">
    <tr>
        <th>
            Appointment ID
        </th>
        <th>
            Tgl. Jadwal
        </th>
        <th>
            Pasien
        </th>
        <th>
            Dokter
        </th>
        @if (User.IsInRole("Dokter"))
        {
        <th>
            No. Telp
        </th>        
        <th>
            @Html.DisplayNameFor(model => model.Keluhan)
        </th>
        }
        <th>
            Dimuat Tgl.
        </th>
        <th></th>
    </tr>

@foreach (var item in Model) {
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.namaUnik)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Jadwal.TanggalJadwal.ToShortDateString())
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Pasien.UserName)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Jadwal.Pengguna.Nama)
        </td>
        @if (User.IsInRole("Dokter"))
        {
        <td>
            @Html.DisplayFor(modelItem => item.PhoneNumber)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Keluhan)
        </td>
        }
        <td>
            @Html.DisplayFor(modelItem => item.CreatedAt)
        </td>
@if (User.IsInRole("Dokter"))
{
        <td>
            [<a href="@Url.Action("Create", "Diagnosis", new { id = item.PasienId})">Diagnosis</a>] |
            @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
            @Html.ActionLink("Details", "Details", new { id = item.Id }) |
            @Html.ActionLink("Delete", "Delete", new { id = item.Id },
            new { onclick = "return confirm('Apakah anda yakin mendelete data ini ?');" })
        </td>
}
@@if (User.IsInRole("Pasien"))
{
    <td>
        
        @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
        @Html.ActionLink("Details", "Details", new { id = item.Id }) |
        @Html.ActionLink("Delete", "Delete", new { id = item.Id },
            new { onclick = "return confirm('Apakah anda yakin mendelete data ini ?');" })
    </td>
}
    </tr>
}

</table>*@
<link href="@Url.Content("~/Content/themes/base/minified/jquery-ui.min.css")" rel="stylesheet" />
<!-- Required jQuery and jQuery UI Javascript references -->
<script src="@Url.Content("~/Scripts/jquery-1.7.1.min.js")"></script>
<script src="@Url.Content("~/Scripts/jquery-ui-1.10.4.min.js")"></script>

<script type="text/javascript">
    $(function () {
        // This will make every element with the class "date-picker" into a DatePicker element
        $('.date-picker').datepicker();
    })
</script>

    @using (Html.BeginForm("Index", "Appointment", FormMethod.Get))
    {
        <p>
            Search By Date: <input type="text" name="searchString" id="date-picker" />
            <input type="submit" value="Cari" />
        </p>
    }
    @if (User.IsInRole("Dokter"))
    {
        <a class="k-button" href="@Url.Action("ShowTommorowRecord", "Appointment")">Cek Besok</a>
        <a class="k-button" href="@Url.Action("ShowTodayRecord", "Appointment")">Cek Hari Ini</a>
    }
    @if (User.IsInRole("Admin"))
    {
        <a href="@Url.Action("SearchTommorowRecord", "Appointment")">Cek Besok</a>
        @*<a href="@Url.Action("SearchPerWeekRecord", "Appointment")">Cek Seminggu</a>*@
    }


    @{
        foreach (var item in Model.Select(a => a.Jadwal.TanggalJadwal).Distinct().OrderByDescending(a => a.Date))
        {
            
            <h3>Jadwal : @item.ToShortDateString()</h3>
            <div>
                <table class="table">
                    <tr>
                        <th>
                            ID
                        </th>
                        <th>
                            Dokter
                        </th>
                        <th>
                            Pasien
                        </th>
                        <th>
                            Sesi
                        </th>
                        <th>
                            Ruang
                        </th>
                        <th>
                            Dimuat Tgl.
                        </th>

                        <th></th>
                    </tr>
                    @foreach (var i in Model.Where(a => a.Jadwal.TanggalJadwal.Equals(@item)))
                    {
                        <tr>
                            <td>
                                @Html.DisplayFor(modelItem => i.namaUnik)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => i.Jadwal.Pengguna.Nama)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => i.Pasien.Nama)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => i.Jadwal.Sesi)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => i.Jadwal.Ruang)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => i.CreatedAt)
                            </td>

                            <td>
                                [<a href="@Url.Action("Create", "Diagnosis", new { id = i.PasienId})">Diagnosis</a>] |
                                @Html.ActionLink("Edit", "Edit", new { Controller = "Appointment", id = i.Jadwal.PenggunaId }, new { @class = "btn btn-default btn-xs" })
                                @Html.ActionLink("Delete", "Delete",
                                new { id = i.Id },
                                new { @class = "btn btn-danger btn-xs", onclick = "return confirm('Are you sure?');" })
                            </td>
                        </tr>
                    }
                </table>
            </div>
        }
    }